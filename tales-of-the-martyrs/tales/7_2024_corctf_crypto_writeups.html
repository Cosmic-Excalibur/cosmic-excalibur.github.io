<!DOCTYPE html>
<html>
<head>
	<link rel='icon' type='image/x-icon' href="/favicon.ico"/>
	<link rel='stylesheet' type='text/css' href="/essence-of-the-elders/skeleton-of-giants.css"/>
	<link rel='stylesheet' href='/essence-of-the-elders/spirit-of-codes/prism.css'/>
	<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:100,300,400,500,700,900"> -->
	<meta charset="UTF-8"/>
	<title>2024 corCTF Crypto Write-ups</title>
</head>
<body>
	<div class="center">
		<h1>2024 corCTF Crypto Write-ups</h1>
		<ul class="navi">
			<li><a href="javascript:history.back()" class="noafter back" title="Back"></a></li>
			<li><a href="/" class="noafter home" title="Homepage"></a></li>
			<li><a href="javascript:history.forward()" class="noafter forward" title="Forward"></a></li>
		</ul>
		<br><br>
	</div>
	<div class="main">

<p>27~28å·æ‰“çš„ï¼Œå°±çœ‹äº†ä¸¤ä¸ªé¢˜ã€‚</p>
<div class="center">
	<img src="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/1.jpg" alt="zzz" width=200></img>
</div>
<br>

<ul class="section"><li>
roots
</li></ul>

<p>é™„ä»¶ï¼š</p>
<ul>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/root.zip">roots.zip</a></li>
</ul>
<br>

<p>å…³é”®éƒ¨åˆ†æ˜¯è¿™é‡Œ</p>
<pre><code class='language-python'>sum(a * Decimal(p).sqrt() for a, p in zip(otp(data), key))</code></pre>
<br>

<p><code>Decimal</code>çš„ç²¾åº¦æ˜¯2024ä¸ªåè¿›åˆ¶ä½çš„æœ‰æ•ˆæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¾“å‡ºä¸­çš„å°æ•°éƒ½ä¹˜ä»¥10çš„æŸä¸ªå¹‚æ¬¡â€”â€”æ¯”å¦‚\(10^{2004}\)â€”â€”æ¥è®©å…¶å˜æˆæ•´æ•°ï¼Œä»è€Œå°†é—®é¢˜è½¬åŒ–ä¸ºæ•´ç¯ä¸Šçš„æ–¹ç¨‹ç»„é—®é¢˜ï¼š</p>
\[
\begin{aligned}
K_{11}\cdot X_1+K_{12}\cdot X_2+K_{13}\cdot X_3+\varepsilon_1&=C_1\\
K_{21}\cdot X_1+K_{22}\cdot X_2+K_{23}\cdot X_3+\varepsilon_2&=C_2\\
K_{31}\cdot X_1+K_{32}\cdot X_2+K_{33}\cdot X_3+\varepsilon_3&=C_3\\
K_{41}\cdot X_1+K_{42}\cdot X_2+K_{43}\cdot X_3+\varepsilon_4&=C_4\\
\end{aligned}
\]

<p>å…¶ä¸­\(C_1,C_2,C_3,C_4\)æ˜¯è¾“å‡ºä¹˜ä»¥\(10^{2004}\)ä»¥åå¾—åˆ°çš„ç»“æœï¼ˆæ•´æ•°ï¼‰ï¼Œè§‚å¯Ÿå‘ç°ï¼Œ\(X_1,X_2,X_3\)ç›¸å½“äºæˆ‘ä»¬åŠ å¯†ç”¨çš„keyï¼Œå¹¶ä¸”ç›¸å¯¹äºOTPè¿‡ç¨‹ä¸­ä½¿ç”¨çš„key \(K_{ij}\)ä»¥åŠè¯¯å·® \(\varepsilon_i\)æ¥è¯´éƒ½éå¸¸åœ°å·¨å¤§ã€‚</p>
<p>å›å¿†ACDé—®é¢˜ï¼ˆApproximate Common Divisor Problemï¼‰çš„è§£æ³•<comment>ï¼ˆè§<a underlined href="https://eprint.iacr.org/2016/215.pdf">Algorithms for the Approximate Common Divisor Problem</a>ï¼‰</comment>ï¼Œç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ„é€ ä¸€ä¸ªæ ¼å°†ä¸Šè¿°æ–¹ç¨‹ç»„ä¸­å·¨å¤§çš„\(X_i\)ç»™æ¶ˆé™¤æ‰ï¼š</p>
\[
L_1=\begin{pmatrix}
C_1 & 1 &&&\\
C_2 && 1 &&\\
C_3 &&& 1 &\\
C_4 &&&& 1\\
\end{pmatrix}
\]

<p>\(L_1\)ä¸­çš„æ ¼ç‚¹æœ‰çŸ­å‘é‡</p>
\[
\vec{v}_1 = \begin{pmatrix}\vec{a}\cdot\vec{\varepsilon} & \vert & \vec{a}\end{pmatrix}
\]

<p>å…¶ä¸­</p>
\[
\vec{a}\in\text{ker}(K)=K^{\perp}\subset\mathbb{Z}^4,\qquad \vec{\varepsilon}=\begin{pmatrix}\varepsilon_1 & \varepsilon_2 & \varepsilon_3 & \varepsilon_4\end{pmatrix}
\]

<p>å¯¹\(L_1\)è¿›è¡Œæ ¼åŸºè§„çº¦ä»¥åå¯ä»¥å¾—åˆ°ä¸‰ä¸ªä¸åŒçš„\(\vec{a}\in\text{ker}(K)\)å‘é‡ã€‚</p>

<p>æ˜¾ç„¶ï¼Œä¸‰ç»„OTP key \((K_{1i},K_{2i},K_{3i},K_{4i}),\ i=1,2,3\) å‡åœ¨\((K^{\perp})^{\perp}\)ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¦é€ ä¸€ä¸ªæ ¼\(L_2\)ï¼Œç”¨æ¥ä»ä¸­ç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„å‘é‡ï¼Œè€Œ\(L_2\)åˆšå¥½å¯ä»¥ç”±æˆ‘ä»¬ä»\(L_1\)ä¸­è·å¾—çš„ä¸‰ä¸ª\(\vec{a}\)å‘é‡ç»„æˆã€‚</p>
\[
	L_2=\begin{pmatrix}
		\vec{a}_1\\
		\vec{a}_2\\
		\vec{a}_3\\
	\end{pmatrix}
\]

<p>å®é™…è®¡ç®—çš„è¿‡ç¨‹ä¸­å¯ä»¥å‘ç°ï¼Œ\(L_2\)çš„æœ€çŸ­å‘é‡ä¸­å„é¡¹çš„æ¯”ç‰¹ä½æ•°åœ¨62å·¦å³ï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡å‘é‡ä¸­å„é¡¹çš„æ¯”ç‰¹ä½æ•°ä¸è¶…è¿‡64ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œ\(L_2\)ä¸­æ•°é‡çº§åœ¨åœ¨64æ¯”ç‰¹ä½ä»¥å†…çš„æ ¼ç‚¹ä¸ä¼šå¤ªå¯†é›†ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡è§£å†³\(L_2\)çš„æœ€è¿‘å‘é‡é—®é¢˜æ¥æ‰¾åˆ°è®¸å¤šä¸ªç¬¦åˆæ¯”ç‰¹ä½æ•°è¦æ±‚çš„æ ¼ç‚¹ï¼Œç„¶åä¸‰ä¸‰è®¡ç®—å„åˆ†é‡çš„å¼‚æˆ–ï¼Œè¿™ä¸ªå¼‚æˆ–å€¼å¯ä»¥ä½œä¸ºåˆ¤æ–­è¿™ä¸‰ä¸ªæ ¼ç‚¹æ˜¯å¦æ˜¯OTP keyçš„ä¾æ®ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨Kannan CVPç®—æ³•æ¥æ±‚è§£éæ–¹é˜µæ ¼åŸºçš„CVPé—®é¢˜<comment>ï¼ˆè§<a underlined href="https://arxiv.org/pdf/0705.0965">Improved Analysis of Kannan's Shortest Lattice Vector Algorithm</a>æˆ–è€…<a underlined href="https://www.math.auckland.ac.nz/~sgal018/crypto-book/ch18.pdf">Algorithms for the Closest and Shortest Vector Problems</a>ï¼‰</comment>ã€‚</p>

<pre><code class="language-python">#https://github.com/maple3142/lll_cvp
def kannan_cvp(mat, target, reduction=(lambda x: x.LLL()), weight=None):
    if weight is None:
        weight = max(target)
    L = block_matrix([[mat, 0], [-matrix(target), weight]])
    for row in reduction(L):
        if row[-1] < 0:
            row = -row
        if row[-1] == weight:
            return row[:-1] + target</code></pre>

<p>æˆ‘ä»¬å¯ä»¥è®©ç›®æ ‡å‘é‡éå†\(2^{n_1-1},2^{n_2-1},2^{n_3-1},2^{n_4-1}\)ä¸\(2^{n_1},2^{n_2},2^{n_3},2^{n_4}\)çš„ä¸­å¿ƒä½ç½®ï¼ˆ\(n_i\in\{64,63,\cdots,59\}\)ï¼‰ï¼Œå°†å¾—åˆ°çš„ä¸åŒå‘é‡å­˜å‚¨ä¸‹æ¥ä½œä¸ºå€™é€‰å€¼ï¼Œæœ€åä¸‰ä¸‰æ£€æµ‹æ˜¯å¦æ»¡è¶³è¦æ±‚å³å¯ã€‚</p>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text">corctf{I'm_r00t1ng_f0R_U!!!!!!!}</code></pre>
<br>
<p>Proof of Conceptï¼š</p>
<ul>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/sol_roots.sage">sol_roots.sage</a></li>
</ul>
<br><br>

<ul class="section"><li>
two-wrongs
</li></ul>

<p>é™„ä»¶ï¼š</p>
<ul>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/two-wrongs.zip">two-wrongs.zip</a></li>
</ul>
<br>

<p>ã‚ªãƒ¼ãƒã‚¤ã‚´ãƒƒãƒ‰ã€Quantum Circuitã ï¼ï¼ˆmomoiéŸ³ï¼‰</p>
<div class="center">
	<img src="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/2.gif" alt="omg" width=200></img>
</div>

<p>å¾—ç ”ç©¶é‡å­çº¿è·¯ï¼Œè¿™é‡Œæˆ‘åªå…³æ³¨äº†ä¸€ä¸ªé‡å­é€»è¾‘é—¨â€”â€”CNOTï¼ˆControlled NOTï¼‰ã€‚CNOTæœ¬è´¨ä¸Šæ˜¯å¯¹ä¸¤ä¸ªé‡å­ä½çš„ä¸€ä¸ªé…‰å˜æ¢ï¼š</p>
\[
	\text{CNOT}=\begin{pmatrix}
	1 & 0 & 0 & 0\\
	0 & 1 & 0 & 0\\
	0 & 0 & 0 & 1\\
	0 & 0 & 1 & 0\\
	\end{pmatrix}
\]
\[
	\text{CNOT}\left(a\left\vert 00\right\rangle+b\left\vert 01\right\rangle+c\left\vert 10\right\rangle+d\left\vert 11\right\rangle\right)=\begin{pmatrix}
	1 & 0 & 0 & 0\\
	0 & 1 & 0 & 0\\
	0 & 0 & 0 & 1\\
	0 & 0 & 1 & 0\\
	\end{pmatrix}
	\begin{pmatrix}
	a\\
	b\\
	c\\
	d\\
	\end{pmatrix}=\begin{pmatrix}
	a\\
	b\\
	d\\
	c\\
	\end{pmatrix}=a\left\vert 00\right\rangle+b\left\vert 01\right\rangle+d\left\vert 10\right\rangle+c\left\vert 11\right\rangle
	
	
\]

<p>å¯¹äºç›®æ ‡çš„ä¸¤ä¸ªé‡å­ä½è€Œè¨€ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªå—æ§çš„å¼‚æˆ–ï¼š</p>

<div class="center">
	<img src="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/3.png" alt="CNOT" width=200></img>
</div>

<p>CNOTç›¸å½“äºä¸€ä¸ªå—æ§çš„Pauli-XçŸ©é˜µè¯±å¯¼çš„å˜æ¢ï¼Œå…¶åœ¨Qiskitä¸­çš„ç¬¦å·ä¸º<code>cx</code>ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œä¸Šè¿°æ¥çº¿æ–¹æ³•è¢«è®°ä¸º<code>cx(x,y)</code>ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªå…„å¼Ÿâ€”â€”<code>cy</code>ä¸<code>cz</code>ã€‚Pauli-Xã€Pauli-Yã€Pauli-ZçŸ©é˜µä½œä¸º\(\text{SL}_2(\mathbb{C})/\{\pm 1\}\)ä¸Šçš„å…ƒç´ é˜¶å‡ä¸º2ï¼Œå¯ä»¥çŒœåˆ°<code>cy</code>ä¸<code>cz</code>ä¹Ÿå…·æœ‰ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°æœ¬é¢˜ä¸­æ¥ï¼Œåªåˆ†æä»£ç ä¸­å«æœ‰<code>cx</code>çš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ<code>main</code>å¯„å­˜å™¨ä¸­ç¬¬6ä¸ªQubitæºå¸¦äº†å¾…è§£å¯†æ¯”ç‰¹çš„ä¿¡æ¯ï¼Œå®ƒåº”å½“è¢«æ¥å…¥åˆ°<code>res</code>å¯„å­˜å™¨ä¸­ï¼Œæ­¤å¤–ï¼Œè¿˜åº”å°†Qubit 1ã€Qubit 2åˆ†åˆ«ä¸<code>res</code>ç›¸æ¥ä»è€Œä¸Qubit 6å†æ¬¡å¼‚æˆ–ï¼Œè¿™æ ·ï¼Œåœ¨æ²¡æœ‰å…¶ä»–å¹²æ‰°çš„æƒ…å†µä¸‹æˆ‘ä»¬çš„<code>res</code>æºå¸¦äº†æ­£ç¡®çš„æ¯”ç‰¹ä¿¡æ¯ã€‚</p>

<p>æ¥ä¸‹æ¥è€ƒè™‘çº¿è·¯ä¸­å…¶ä»–çš„å¹²æ‰°å¯¹Qubit 6çš„å½±å“ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥ç³»ç»Ÿå‰©ä½™çš„éƒ¨åˆ†è§†ä½œä¸€ä¸ªé»‘ç›’å­ï¼Œå§‹ç»ˆæŒ‰ç…§ä¸Šè¿°æ–¹å¼æ¥çº¿å¹¶è§‚å¯Ÿè¾“å‡ºä¸<code>sensor_val</code>ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥å‘ç°ï¼Œå½“<code>sensor_val</code>çš„æ¯”ç‰¹ä½ç»„åˆä¸ºå¦‚ä¸‹ä¸‰ç§æƒ…å†µæ—¶ï¼Œç›®æ ‡å­—èŠ‚ä¸­å¯¹åº”ä½ç½®å¤„åŸæœ¬æ­£ç¡®çš„æ¯”ç‰¹ä½ä¼šè¢«ç¿»è½¬ï¼Œå¦åˆ™ä¸ç¿»è½¬ã€‚</p>
<pre><code class="language-text">110 000 -> flip
010 000 -> flip
100 000 -> flip
others  -> hold</code></pre>

<p>æ­¤å¤–ï¼Œå‰ä¸‰æ¯”ç‰¹ä¸åä¸‰æ¯”ç‰¹ä¸åŒæ—¶ä¸å…¨ä¸º0ï¼Œå› æ­¤å³ä¾¿æˆ‘ä»¬å°†æ¯ä¸ª<code>sensor_val</code>çš„åä¸‰æ¯”ç‰¹ä½ç»™maskæ‰ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½åˆ¤æ–­ç›®æ ‡æ¯”ç‰¹æ˜¯å¦ä¼šè¢«ç¿»è½¬ï¼Œæ®æ­¤ä¾¿å¯å°è¯•ä¸é¶æœºäº¤äº’ã€‚</p>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text">corctf{c0rr3ct_CORr3Ct!nG_9aenq}</code></pre>
<br>
<p>Proof of Conceptï¼š</p>
<ul>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagiri/7/exp_twowrongs.py">exp_twowrongs.py</a></li>
</ul>
<br><br>



</div>
<br><br><br><br><br><br>
<br><br><br><br><br><br><p style="color:gray">Tags: <span style="color:blue"><b>#Crypto</b></span><span color="gray">, </span><span style="color:blue"><b>#LatticeBasedCryptography</b></span><span color="gray">, </span><span style="color:blue"><b>#QuantumCircuit</b></span><span color="gray">, </span><span style="color:blue"><b>#corCTF</b></span></p>
                    <p><div class="time"></div><span style="color:gray">Time: </span><b>2024-08-02 22:09</b></p><br><br><br><br><br><br>
	<script type="text/javascript" src="/essence-of-the-elders/spirit-of-mathematics/MathJax.js?config=TeX-AMS_HTML" async></script>
	<script type="text/x-mathjax-config;executed=true">
        window.MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]],
                displayMath: [["$$", "$$"], ["\\[", "\\]"]],
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"]
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"],
                showMathMenu: false
            },
			SVG: { linebreaks: {automatic: true } }
        });
        //window.MathJax.Hub.Queue(["Typeset", MathJax.Hub,document.getElementsByClassName("ck-content")]);
	</script>
	<script src="/essence-of-the-elders/spirit-of-codes/prism.js"></script>
</body>
</html>