<!DOCTYPE html>
<html>
<head>
	<link rel='icon' type='image/x-icon' href="/favicon.ico"/>
	<link rel='stylesheet' type='text/css' href="/essence-of-the-elders/skeleton-of-giants.css"/>
	<link rel='stylesheet' href='/essence-of-the-elders/spirit-of-codes/prism.css'/>
	<!-- <link rel="stylesheet" type="text/css" href="http://tikzjax.com/v1/fonts.css">
	<script src="https://tikzjax.com/v1/tikzjax.js"></script> -->
	<!-- <link rel="stylesheet" type="text/css" href="/essence-of-the-elders/aesthetics-of-mathematics/tikzjax/fonts.css"/>
	<script src="/essence-of-the-elders/aesthetics-of-mathematics/tikzjax/tikzjax.js"></script> -->
	<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:100,300,400,500,700,900"> -->
	<meta charset="UTF-8"/>
	<title>2024 SpiritCTF Warmup Official Write-ups by Astrageldon</title>
</head>
<body>
	<div class="center">
		<h1>2024 SpiritCTF Warmup Official Write-ups by Astrageldon</h1>
		<ul class="navi">
			<li><a href="javascript:history.back()" class="noafter back" title="Back"></a></li>
			<li><a href="/" class="noafter home" title="Homepage"></a></li>
			<li><a href="javascript:history.forward()" class="noafter forward" title="Forward"></a></li>
		</ul>
		<br><br>
	</div>
	<div class="main">

<p>ç›®å½•ï¼š<ul><details open>
    <summary></summary>
    <li><a href="#tag-preface" class="noafter">å‰è¨€</a></li>
    <li><a href="#tag-what-is-rsa" class="noafter">(Week 1) Crypto - What is RSA?</a></li>
    <li><a href="#tag-secret-shredder-1" class="noafter">(Week 1) Crypto - Secret Shredder 1</a></li>
    <li><a href="#tag-long-words-1" class="noafter">(Week 1) Crypto - Long Words 1</a></li>
    <li><a href="#tag-essence-of-the-elders" class="noafter">(Week 1) Crypto - Essence of The Elders</a></li>
    <li><a href="#tag-secret-shredder-2" class="noafter">(Week 1) Crypto - Secret Shredder 2</a></li>
    <li><a href="#tag-secret-shredder-3" class="noafter">(Week 1) Crypto - Secret Shredder 3</a></li>
    <li><a href="#tag-secret-shredder-4" class="noafter">(Week 1) Crypto - Secret Shredder 4</a></li>
    <li><a href="#tag-cirno-no-perfect-sannsuu-kyoushitsu" class="noafter">(Week 1) Crypto - â‘¨ãƒãƒ«ãƒã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã•ã‚“ã™ã†æ•™å®¤</a></li>
</details></ul></p>
<br><br>

<ul class="section" id="tag-preface"><li>
    å‰è¨€
</li></ul>
<p>è¿™ç¯‡æ–‡ç« æ˜¯2024 SpiritCTF Warmupä¸­ä¸€äº›é¢˜ç›®ï¼ˆè§ç›®å½•ï¼‰çš„å®˜æ–¹é¢˜è§£ã€‚</p>
<br><br>

<ul class="section" id="tag-what-is-rsa"><li>
    Crypto - What is RSA?
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/what-is-rsa.zip">what-is-rsa.zip</a></li>
</ul>
<br>

<p>RSAæ˜¯ç”±Ron Rivestã€Adi Shamirå’ŒLeonard Adlemanæå‡ºçš„ä¸€ç§éå¯¹ç§°å¯†ç ç³»ç»Ÿã€‚ä¼ è¾“ä¿¡æ¯æ—¶ï¼ŒåŠ å¯†è€…ä½¿ç”¨å…¬é’¥åŠ å¯†ä¿¡æ¯ï¼Œè§£å¯†è€…ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯ã€‚ä¸å¯¹ç§°å¯†ç ä¸åŒçš„æ˜¯ï¼Œä½¿ç”¨å…¬é’¥åŠ å¯†åçš„ä¿¡æ¯å¿…é¡»ä½¿ç”¨ç§é’¥è§£å¯†ï¼ˆè€Œéå…¬é’¥ï¼‰ã€‚RSAçš„åŸºæœ¬åŸç†æ˜¯æ¬§æ‹‰å®šç†ï¼ˆEuler's theoremï¼‰ï¼ˆå‚è§<a href="https://oi-wiki.org/math/number-theory/fermat/" underlined>OI-Wiki</a>ï¼‰ï¼š</p>

\[
    ed\equiv 1\pmod{\varphi(N)},\quad N=pq,\quad \varphi(N)=(p-1)(q-1)
\]
\[
    c\equiv m^e\pmod{N},\quad c^d\equiv m^{ed}\equiv m^{1+k\varphi(N)}\equiv m\cdot (m^{\varphi(N)})^k\equiv m \pmod{N}
\]

<p>å…¶ä¸­\(e\)æ˜¯æˆ‘ä»¬çš„å…¬é’¥ï¼Œè€Œ\(d\)æ˜¯æˆ‘ä»¬çš„ç§é’¥ï¼Œ\(m,c\)åˆ†åˆ«æ˜¯æ˜æ–‡å’Œå¯†æ–‡ã€‚æœ¬é¢˜ç»™å‡ºäº†\(p,q,e\)çš„å€¼ï¼Œå¹¶ä¸”ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰\(e\)ä¸\(\varphi(N)\)ä¸äº’ç´ ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚è§£\(e\)åœ¨æ¨¡\(\varphi(N)\)æ„ä¹‰ä¸‹çš„ä¹˜æ³•é€†å…ƒï¼ˆå‚è§<a href="https://oi-wiki.org/math/number-theory/inverse/" underlined>OI-Wiki</a>ï¼‰è½»æ˜“åœ°æ±‚å‡º\(d\)çš„å€¼ï¼š</p>

<pre><code class="language-python"># Python 3.x
phi = (p-1) * (q-1)
d = pow(e, -1, phi)</code></pre>
<br>

<p>é€šè¿‡ç§é’¥\(d\)ä¸å¯†æ–‡\(c\)å³å¯è¿˜åŸå‡ºæ˜æ–‡\(m\)çš„å€¼ï¼š</p>
<pre><code class="language-python"># pip install pycryptodome
from Crypto.Util.number import *
m = pow(c, d, N)
flag = long_to_bytes(m)</code></pre>
<br>

<p>å…¶ä¸­æ˜æ–‡çš„å­—èŠ‚ç»è¿‡å¤§ç«¯åºç¼–ç ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-text">Char:   S   p   i   r   i   t   {   }   
        |   |   |   |   |   |   |   |
        v   v   v   v   v   v   v   v
Ascii:  53  70  69  72  69  74  7B  7D</code></pre>
<br>

<p>ä¹Ÿå³</p>
<pre><code class="language-python">bytes_to_long(b'Spirit{}') == 0x5370697269747B7D == 6012421442656041853</code></pre>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_what-is-rsa.py">sol_what-is-rsa.py</a></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{w3lc0mE_t0_7he_W0rLd_oF_Crypt0graphy_:p}</code></pre>

<br><br>

<ul class="section" id="tag-secret-shredder-1"><li>
    Crypto - Secret Shredder 1
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/secret-shredder-1.zip">secret-shredder-1.zip</a></li>
</ul>
<br>

<p>ä¹Ÿæ˜¯ä¸€ä¸ªRSAçš„é—®é¢˜ï¼Œä¸è¿‡è¿™æ¬¡æ²¡æœ‰på’Œqäº†ï¼Œå¾—é€šè¿‡å…¶ä»–çš„æ–¹æ³•æŠŠç§é’¥dç»™æ±‚å‡ºæ¥ï¼Œè€Œè¿™é€šå¸¸æ„å‘³ç€æˆ‘ä»¬éœ€è¦çŸ¥é“Nçš„æ‰€æœ‰å› å­ï¼ˆN=pqï¼‰ã€‚é¢˜ç›®æ³„éœ²å‡ºæ¥äº†ä¸€ä¸ªç‰¹æ®Šçš„å‚æ•°dp<comment>ï¼ˆä¹Ÿå³å‘ç”Ÿäº†â€œdpæ³„éœ²â€ï¼‰</comment>ï¼š</p>
<pre><code class="language-python">dp = d % (p-1)</code></pre>
<br>

<p>å°è¯•å°†è¿™ä¸ªå‚æ•°å¸¦å…¥åˆ°å…¬é’¥å’Œç§é’¥æ»¡è¶³çš„æ–¹ç¨‹ä¸­ï¼š</p>
\[
    \begin{aligned}
        e\cdot\text{dp} &= e\cdot (d+k_1(p-1))\\
        &=1+k_2(p-1)(q-1)+k_1e(p-1)\\
        &=1+k(p-1)
    \end{aligned}
\]

<p>ç°åœ¨ï¼Œç”±äº\(0 \le \text{dp} < p-1\)ï¼Œæˆ‘ä»¬çŸ¥é“ï¼š</p>
\[
    0\le k = \frac{e\cdot\text{dp}-1}{p-1} < e
\]

<p>æœ¬é¢˜ä¸­å…¬é’¥æŒ‡æ•°\(e\)æ˜¯ä¸€ä¸ªä¸å¤§çš„æ•°å­—ï¼ˆ<code>0x114514 + 1 = 1131797</code>ï¼‰ï¼Œåœ¨0~eçš„èŒƒå›´å†…ç©·ä¸¾kï¼Œå¯¹äºæ¯ä¸ªkè€Œè¨€è®¡ç®—å¯¹åº”çš„pï¼ŒéªŒè¯pæ˜¯ä¸æ˜¯Nçš„å› å­å³å¯ã€‚</p>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_secret-shredder-1.py">sol_secret-shredder-1.py</a></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{dp_0r_dq_l3akAg3_1s_dAn6er0us_(s0rt_of)}</code></pre>

<br><br>

<ul class="section" id="tag-long-words-1"><li>
    Crypto - Long Words 1
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/long-words-1.zip">long-words-1.zip</a></li>
</ul>
<br>

<p>æºç ç¬¬ä¸‰è¡Œç»™äº†ä¸€ä¸ªFlagğŸš©é•¿åº¦çš„æç¤ºï¼š</p>
<pre><code class='language-python'>assert len(flag) == 54    # Oh...</code></pre>
<br>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜æ–‡mçš„å¤§å°å¤§è‡´ä¸ºï¼š</p>
\[
    2^{431}=2^{54\times 8-1}\le m < 2^{54\times 8}=2^{432}
\]

<p>å¯ä»¥æ±‚å‡ºNçš„å¤§å°å¤§è‡´ä¸º</p>
\[
    2^{419} \le N < 2^{420}
\]

<p>åœ¨åŠ è§£å¯†çš„è¿‡ç¨‹ä¸­mä¼šè¢«æ¨¡æ‰Nï¼Œå› æ­¤måœ¨è¶…è¿‡Nçš„æ—¶å€™ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä½†æ˜¯ä¸æ”¹å˜å‰çš„måªç›¸å·®Nçš„æŸä¸ªæ•´æ•°å€ï¼š</p>
\[
    m\bmod{N} = m - k\cdot N,\quad 0 < k < 2^{13}
\]

<p>ç©·ä¸¾è¿™ä¸ªkï¼Œç›´è‡³è§£å‡ºæ¥çš„å­—èŠ‚ä¸²å¼€å¤´ä¸º<code>Spirit{</code>å³å¯ã€‚</p>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_long-words-1.py">sol_long-words-1.py</a><comment>ï¼ˆpip install tqdmï¼‰</comment></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{0verflOwing_oF_iNpu7s_1s_Ov3rf1owIn9_0f_j0y_:p}</code></pre>

<br><br>

<ul class="section" id="tag-essence-of-the-elders"><li>
    Crypto - Essence of The Elders
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/essence-of-the-elders.zip">essence-of-the-elders.zip</a></li>
</ul>
<br>

<p>ç»™äº†å››ä¸ªå¯†æ–‡ï¼š</p>
<pre><code class="language-text">Vyjuru{fubvbjfjm_frqknsv_jsh_
2C602?4:6?E05F==02?50H62<
aHdkTHhBSjFtWFdtTWtXRUJNU0d3Qm5aZVdCNWZlcDV1UWliWGdnaXJiR0Y4Szh0SHRIMTRIa010elkyUzJwMmpDNXg=
nhxalwuhyasen_fxflgzf}</code></pre>
<br>

<p>åˆ†åˆ«å¯¹åº”å››ç§ä¸åŒçš„å¤å…¸å¯†ç ã€‚è§£å¯†åæ‹¼æ¥åœ¨ä¸€èµ·å°±æ˜¯FlagğŸš©ã€‚å¯ä»¥ä½¿ç”¨<a href="https://cyberchef.org/" underlined>CyberChef</a>è¾…åŠ©åˆ†æã€‚</p>
<p>å¯¹äºç¬¬ä¸€ä¸ªå¯†æ–‡è€Œè¨€ï¼Œå¯ä»¥å°è¯•Caesarå¯†ç å’ŒVigenÃ¨reå¯†ç ï¼Œç”±äºFlagğŸš©çš„å¼€å¤´æ˜¯<code>Spirit{</code>ï¼Œå¯ä»¥æ¨æ–­å‡ºåŠ å¯†ç”¨çš„å¯†é’¥ï¼š</p>
<pre><code class="language-text">V - S = 3 = d
y - p = 9 = j
j - i = 1 = b
u - r = 3 = d
r - i = 9 = j
u - t = 1 = b</code></pre>
<br>

<p>å¯è§åŠ å¯†ç”¨çš„å¯†é’¥ä¸º<code>djb</code>ï¼Œè§£å¯†åç¬¬ä¸€å¥æ˜æ–‡å³ä¸º</p>
<pre><code class="language-text">Spirit{classical_ciphers_are_</code></pre>
<br>

<p>ç¬¬äºŒå¥æ˜æ–‡ä¸­å«æœ‰<code>:=&lt;?</code>ä¹‹ç±»çš„å­—ç¬¦ï¼ˆå®ƒä»¬åœ¨ASCIIç è¡¨ä¸Šå¾ˆæ¥è¿‘ï¼‰ï¼Œæ³¨æ„åˆ°ROT47ç¼–ç åçš„å°å†™å­—æ¯ä¸­å°±å«æœ‰è¿™äº›å­—ç¬¦ï¼ˆ<code>23456789:;&lt;=>?@ABCDEFGHIJK</code>ï¼‰ï¼Œä½¿ç”¨ROT47å°†å¯†æ–‡å˜æ¢ä¸€æ¬¡å³å¯å¾—åˆ°ç¬¬äºŒæ®µæ˜æ–‡ï¼š</p>
<pre><code class="language-text">are_ancient_dull_and_weak</code></pre>
<br>

<p>ç¬¬ä¸‰å¥å¯†æ–‡ä¸ºBaseç³»åˆ—çš„ç¼–ç å¥—å¨ƒï¼Œä½¿ç”¨<a href="https://cyberchef.org/" underlined>CyberChef</a>å¯ä»¥å¾ˆå¿«åœ°æ‰¾åˆ°æ¯å±‚å¥—å¨ƒä½¿ç”¨äº†å“ªç§Baseç¼–ç â€”â€”å°†å¯†æ–‡ä¸¢è¿›CyberChefä¸­ï¼Œåå¤ç‚¹å‡»Outputä¸€æ ä¸­çš„é­”æœ¯æ£’ï¼Œå¯ä»¥å‘ç°ä½¿ç”¨çš„ç¼–ç æ–¹å¼ä¾æ¬¡ä¸ºBase32ã€Base85ã€Base58ä»¥åŠBase64ï¼Œè§£ç åçš„ç¬¬ä¸‰å¥æ˜æ–‡ä¸º</p>
<pre><code class="language-text">_preceding_the_modern_</code></pre>
<br>

<p>ç¬¬å››å¥å¯†æ–‡ç»è¿‡äº†æŸä¸ªéšæœºçš„å•è¡¨æ›¿æ¢åŠ å¯†ï¼Œè¿™ç§åŠ å¯†çš„ä¸¥é‡ç¼ºé™·å°±åœ¨äºå¯†æ–‡è¶³å¤Ÿé•¿åï¼Œå¯ä»¥é€šè¿‡é¢‘ç‡åˆ†ææ¥æ¨æµ‹å‡ºä½¿ç”¨çš„æ›¿æ¢è¡¨æ˜¯ä»€ä¹ˆã€‚è¿™é‡Œçš„ç¬¬å››å¥å¯†æ–‡å·²ç»å¾ˆé•¿äº†ï¼Œä½¿ç”¨<a href="https://quipqiup.com/" underlined>quipqiup</a><comment>ï¼ˆstatisticsæˆ–dictionaryï¼‰</comment>ç ´è§£å¾—åˆ°ç¬¬å››å¥æ˜æ–‡ï¼š</p>
<pre><code class="language-text">cryptographic_systems}</code></pre>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{classical_ciphers_are_ancient_dull_and_weak_preceding_the_modern_cryptographic_systems}</code></pre>

<br><br>

<ul class="section" id="tag-secret-shredder-2"><li>
    Crypto - Secret Shredder 2
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/secret-shredder-2.zip">secret-shredder-2.zip</a></li>
</ul>
<br>

<p>æ ¹æ®<code>task.py</code>çš„ç¬¬å…­è¡Œï¼ŒFlagğŸš©çš„é•¿åº¦å¾ˆçŸ­ï¼Œåªæœ‰62ä¸ªå­—èŠ‚ï¼Œå› æ­¤</p>
\[
    m < 2^{62\times 8} = 2^{496} < r
\]

<p><code>task.py</code>ä¸­æ³„éœ²å‡ºæ¥äº†drçš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>r = n // N</code>æ±‚å‡ºrçš„å€¼ï¼Œæ­¤å¤–ï¼Œ</p>
\[
    c^{\text{dr}}\equiv m^{e\cdot \text{dr}}=m^{ed+k(r-1)}=m^{1+k'(r-1)}\equiv m\pmod{r}
\]

<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_secret-shredder-2.py">sol_secret-shredder-2.py</a></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{wHy_1s_7hIs_s3ntenc3_s0_sh0rt_:P_haaahahhahahahahahaha}</code></pre>

<br><br>

<ul class="section" id="tag-secret-shredder-3"><li>
    Crypto - Secret Shredder 3
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/secret-shredder-3.zip">secret-shredder-3.zip</a></li>
</ul>
<br>

<p>æˆ‘ä»¬çš„æ¨¡æ•°Nç”±11ä¸ªè¾ƒå°çš„å› å­ç»„æˆï¼Œä½¿ç”¨<a href="https://github.com/bbuhrow/yafu" underlined>yafu</a>åˆ†è§£å‡ºæ‰€æœ‰çš„ç´ å› å­ï¼š</p>
<pre><code class="language-text">p1 = 1456816928952903451288321
p2 = 1180631507244313172259317
p3 = 3508528846920815938385917
p4 = 874477631144547516656417
p5 = 18142637370007560313
p6 = 9354603989443008841
p7 = 616731256885779378669619
p8 = 10675957053962043419
p9 = 733512956178311394656173
p10 = 1070216324958435392922817
p11 = 659277714257194585234501</code></pre>

<p>æ¥ä¸‹æ¥è¿˜éœ€è¦ç¡®å®šè¿™äº›å› å­çš„é¡ºåºï¼Œæˆ‘ä»¬ä¸èƒ½ä»…ä»…å‡­å€Ÿyafuæ¥åˆ¤æ–­p1å¯¹åº”çš„æ˜¯pã€qã€...ã€yè¿˜æ˜¯zã€‚p~zè¿™åä¸€ä¸ªå› å­çš„æ¯”ç‰¹ä½æ•°éƒ½æ˜¯ç¡®å®šçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é¦–å…ˆæŒ‰ç…§æ¯”ç‰¹ä½æ•°æ¥ç»™p1~p11åˆ†ç»„ï¼Œå¯¹äºæ¯ä¸ªç»„å†…çš„å› å­è€Œè¨€ï¼Œç©·ä¸¾è¿™ä¸ªç»„çš„ç½®æ¢ï¼Œå½“æ‰€æœ‰ç»„çš„é¡ºåºéƒ½æ­£ç¡®åï¼Œè§£å‡ºæ¥çš„å­—èŠ‚ä¸²ä¼šä»¥<code>Spirit{</code>å¼€å¤´ã€‚æ—¶é—´å¤æ‚åº¦ä¸º</p>
\[
    \mathcal{O}(k_1!\cdots k_r!)
\]

<p>å…¶ä¸­\(k_1,\cdots,k_r\)ä¸ºæ¯ä¸ªç»„ä¸­å› å­çš„æ•°é‡ã€‚åœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬åªéœ€è¦è¿›è¡Œ\(3!\cdot 6!=4320\)æ¬¡ç©·ä¸¾å³å¯ï¼Œè€Œæ¯æ¬¡ç©·ä¸¾æ—¶åªéœ€è¦å¯¹æ‰€æœ‰çš„å¯†æ–‡åº”ç”¨ä¸€æ¬¡<a href="https://oi-wiki.org/math/number-theory/crt/" underlined>ä¸­å›½å‰©ä½™å®šç†</a>æ¢å¤å‡ºæ¨¡Næ„ä¹‰ä¸‹çš„å¯†æ–‡cï¼Œæ¥ä¸‹æ¥åªéœ€æŒ‰ç…§å¸¸è§„çš„RSAè§£å¯†æ­¥éª¤è¿›è¡Œè§£å¯†å³å¯ã€‚ï¼ˆ<code>pad</code>å‡½æ•°å°†æ˜æ–‡å¡«å……åˆ°100ä¸ªå­—èŠ‚ï¼Œè¿™æ ·ä¸€æ¥mæ—¢æ¯”Nï¼ˆ829æ¯”ç‰¹ä½ï¼‰å°ï¼Œåˆæ¯”Nçš„ä»»ä½•ä¸€ä¸ªå› å­éƒ½å¤§ï¼‰</p>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_secret-shredder-3.py">sol_secret-shredder-3.py</a></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{Ch1nes3_r3mainder_7HeoRem_1s_A_p0werful_t00l_aNd_a_fUd5mentaL_pr0pertY_1n_nuMb3r_7He0ry_:D}</code></pre>

<br><br>

<ul class="section" id="tag-secret-shredder-4"><li>
    Crypto - Secret Shredder 4
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/secret-shredder-4.zip">secret-shredder-4.zip</a></li>
</ul>
<br>

<p>åŒä¸€ä»½æ˜æ–‡ç”¨åŒæ ·çš„æ¨¡æ•°Nå’Œä¸‰ä¸ªä¸åŒçš„å…¬é’¥e1,e2,e3åˆ†åˆ«åŠ å¯†äº†ä¸‰ä»½ï¼Œä¹Ÿå³ï¼š</p>
\[
    \left\{
    \begin{aligned}
        c_1&\equiv m^{e_1} \pmod{N}\\
        c_2&\equiv m^{e_2} \pmod{N}\\
        c_3&\equiv m^{e_3} \pmod{N}\\
    \end{aligned}\right.
\]

<p>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°\(s_1,s_2,s_3\)ä½¿å¾—</p>
\[
    s_1e_1+s_2e_2+s_3e_3=1
\]

<p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ¢å¤å‡ºæ˜æ–‡\(m\)ï¼š</p>
\[
    m=m^{s_1e_1+s_2e_2+s_3e_3}\equiv c_1^{s_1}c_2^{s_2}c_3^{s_3}\pmod{N}
\]

<p>å¦‚ä½•æ±‚è§£è¿™ä¸‰ä¸ªå‚æ•°å‘¢ï¼Ÿå¯ä»¥å…ˆå¯¹e1ä¸e2åº”ç”¨<a href="https://oi-wiki.org/math/number-theory/gcd/" underlined>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</a>ï¼Œæ‰¾åˆ°k1ã€k2ä½¿å¾—</p>
\[
    k_1e_1+k_2e_2=\text{gcd}(e_1,e_2)=e_{12}
\]

<p>å†æ‰¾åˆ°k3ã€k4ä½¿å¾—</p>
\[
    k_3e_{12}+k_4e_3=\text{gcd}(e_{12},e_3)=\text{gcd}(e_1,e_2,e_3)
\]

<p>äºæ˜¯</p>
\[
    \left\{
    \begin{aligned}
        s_1 &= k_1k_3\\
        s_2 &= k_2k_3\\
        s_3 &= k_4\\
    \end{aligned}\right.
\]

<p>ä¸è¿‡ä¸å¹¸çš„æ˜¯ï¼Œæœ¬é¢˜ä¸­\(\text{gcd}(e_1,e_2,e_3)=2\ne 1\)ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬æœ€å¤šåªèƒ½æ¢å¤å‡º\(m_2=m^2\bmod{N}\)ï¼š</p>
\[
    m^2=m^{s_1e_1+s_2e_2+s_3e_3}\equiv c_1^{s_1}c_2^{s_2}c_3^{s_3}\pmod{N}
\]
\[
    m_2 = m^2 + k\cdot N
\]

<p>æˆ‘ä»¬çŸ¥é“FlagğŸš©ç»è¿‡å¡«å……åçš„é•¿åº¦ä¸º129å­—èŠ‚ï¼Œä¹Ÿå³</p>
\[
    \begin{aligned}
        m &< 2^{129\times 8}=2^{1032}\\
        m^2 &< 2^{2064}\\
        N &< 2^{2048}\\
    \end{aligned}
\]

<p>å› æ­¤</p>
\[
    k < 2^{16}
\]

<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥åƒ<a href="#tag-long-words-1" underlined>Crypto - Long Words 1</a>é‚£æ ·ç©·ä¸¾kæ¥å¯»æ‰¾çœŸæ­£çš„æ˜æ–‡mã€‚</p>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_secret-shredder-4.py">sol_secret-shredder-4.py</a><comment>ï¼ˆpip install gmpy2ï¼‰</comment></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{eXt3nDed_Eucl1d_s_alg0ri7hm_:)}</code></pre>

<br><br>

<ul class="section" id="tag-cirno-no-perfect-sannsuu-kyoushitsu"><li>
    Crypto - â‘¨ãƒãƒ«ãƒã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã•ã‚“ã™ã†æ•™å®¤
</li></ul>

<p>é™„ä»¶åœ¨æ­¤ï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/cirno-no-perfect-sannsuu-kyoushitsu.zip">cirno-no-perfect-sannsuu-kyoushitsu.zip</a></li>
</ul>
<br>

<p><code>baka.py</code>ä¸­å°†FlagğŸš©åˆ†æˆäº†ä¸‰ä»½å¹¶åˆ†åˆ«è¿›è¡Œäº†ä¸åŒçš„åŠ å¯†ï¼Œè§£å‡ºè¿™ä¸‰ä¸ªé—®é¢˜æ‰èƒ½è¿˜åŸåŸæ¥çš„FlagğŸš©ã€‚</p>

<p>â‘  ç¬¬ä¸€ä¸ªé—®é¢˜ç»™å‡ºäº†Q1_1ä¸Q1_2çš„ç»“æœï¼Œå®ƒä»¬ä¸ç¬¬ä¸€ä¸ªRSAåŠ å¯†çš„å› å­p1ã€p2ä¹‹é—´æ»¡è¶³å¦‚ä¸‹çš„å…³ç³»å¼ï¼š</p>
\[
    \left\{
    \begin{aligned}
        Q_{11} &= k_1\cdot p_1^{e_1} + k_2\cdot q_1^{e_2}\bmod{N_1}\\
        Q_{12} &= k_3\cdot p_1^{e_3} + k_4\cdot q_1^{e_4}\bmod{N_1}\\
    \end{aligned}\right.
    \tag{1}\label{1}
\]

<p>æ³¨æ„åˆ°ï¼ˆ<a href="https://en.wikipedia.org/wiki/Freshman%27s_dream" underlined>Freshman's dream</a>ï¼‰ï¼š</p>
\[
    (ap+bq)^k \equiv a^k p^k + b^k q^k \pmod{N},\quad N=pq
\]

<p>æˆ‘ä»¬å¯ä»¥ä»\(\eqref{1}\)å¼ä¸­æ¢å¤å‡º\(p_1\)ä¸\(q_1\)ï¼š</p>
\[
\left\{
    \begin{aligned}
        q_1 &= \text{gcd}(k_3^{e_1}Q_{11}^{e_3}-k_1^{e_3}Q_{12}^{e_1}\bmod{N_1}, N_1)\\
        p_1 &= N_1/q_1\\
    \end{aligned}\right.
\]

<p>æ®æ­¤è§£å¯†ç¬¬ä¸€ä¸ªRSAå¯†æ–‡å¾—åˆ°ï¼š</p>

<pre><code class="language-text">Spirit{u_r_a_baka_1n_m4</code></pre>
<br>

<p>â‘¡ ç¬¬äºŒä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬æ±‚å‡ºæ¨¡æ•°N2ã€‚<code>baka.py</code>çš„83~97è¡Œæ˜¯ä¸€ä¸ªæ³°å‹’çº§æ•°éƒ¨åˆ†å’Œçš„è®¡ç®—è¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š</p>
\[
    Q_2=\sum\limits_{k=1}^{18905}\frac{2}{2k-1}x^{2k-1},\quad x=\frac{N_2'-1}{N_2'+1},\quad N_2'=\frac{N_2}{10^{615}}
    \tag{2}\label{2}
\]

<p>æˆ‘ä»¬çŸ¥é“ï¼š</p>
\[
    \begin{aligned}
        \text{ln}\ \left(\frac{1+x}{1-x}\right) &= \sum\limits_{k=1}^{\infty}\left(\frac{(-1)^{k+1}}{k}x^k+\frac{1}{k}x^k\right)\\
        &= \sum\limits_{k=1}^{\infty} \frac{2}{2k-1}x^{2k-1},\qquad \vert x\vert < 1
    \end{aligned}
\]

<p>ä¹Ÿå³</p>
\[
    \text{ln}\ x = \sum\limits_{k=1}^{\infty} \frac{2}{2k-1}\left(\frac{x-1}{x+1}\right)^{2k-1},\qquad x > 0
\]

<p>è§£è°œçš„æ—¶å€™åªéœ€è¦æ¨åˆ°è¿™ä¸€æ­¥å°±å¤Ÿäº†ï¼ˆç”šè‡³äºï¼Œéšä¾¿å–å‡ ä¸ªå€¼ä»£å…¥\(\eqref{2}\)å¼ä¸­ï¼ŒçŒœå‡ºè¿™æ˜¯ä¸€ä¸ªæ±‚è‡ªç„¶å¯¹æ•°çš„è¿‡ç¨‹ä¹Ÿå¯ä»¥ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ›´è¿›ä¸€æ­¥åœ°åˆ†æä¸€ä¸‹è¯¯å·®ï¼š</p>
\[
    \text{ln}\ x = \left[\sum\limits_{k=1}^{n} \frac{2}{2k-1}\left(\frac{x-1}{x+1}\right)^{2k-1}\right] + \left[\sum\limits_{k=n+1}^{\infty} \frac{2}{2k-1}\left(\frac{x-1}{x+1}\right)^{2k-1}\right], \qquad x > 0
\]

<p>äºæ˜¯ï¼Œ</p>
\[
    \begin{aligned}
        \text{ln}\ N_2' - Q_2 &< \sum\limits_{k=n+1}^{\infty} \frac{2}{2k-1}\beta^{2k-1}\\
        &< \frac{2}{2n+1}\cdot\frac{\beta^{2n+1}}{1-\beta}\\
        &< 10^{-1019},\qquad \beta=\frac{2^{2048}/10^{615}-1}{2^{2048}/10^{615}+1},\qquad n=18905
    \end{aligned}
\]

<p>æˆ‘ä»¬è®¡ç®—å¹‚æ—¶çš„ç»å¯¹è¯¯å·®æ»¡è¶³</p>
\[
    \begin{aligned}
        \Delta &< e^{2^{2048}/10^{615}+10^{-1019}} - e^{2^{2048}/10^{615}}\\
        &< 10^{-1004}
    \end{aligned}
\]

<p>è¿™ä¸ªç²—ç³™çš„ä¼°è®¡è¯´æ˜æˆ‘ä»¬è¶³ä»¥é€šè¿‡è¾“å‡ºä¸­çš„Q2æ¥æ±‚å‡º\(N_2'\)ï¼š</p>

<ul>ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰
<li>Pythonï¼š<code>N2 = round(Decimal(Q2).exp() * 10**615)</code></li>
<li>SageMathï¼ˆ<a href="https://doc-10-4--sagemath.netlify.app/html/en/installation/" underlined>å®‰è£…æ•™ç¨‹</a>ï¼Œ<a href="https://sagecell.sagemath.org/" underlined>ç½‘é¡µç«¯</a>ï¼‰ï¼š<code>rr = RealField(10000); N2 = round(exp(rr(Q2)) * 10**615)</code></li>
</ul>
<br>

<p>æ®æ­¤è§£å¯†ç¬¬äºŒä¸ªRSAå¯†æ–‡å¾—åˆ°ï¼š</p>

<pre><code class="language-text">th_:p__--Cirno____baka9b</code></pre>
<br>

<p>â‘¨ ç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå®šç§¯åˆ†çš„è¿‘ä¼¼è®¡ç®—è¿‡ç¨‹ï¼š</p>
\[
    \begin{aligned}
        Q_3 &= \frac{1}{n}\sum\limits_{k=0}^{n-1}\frac{10^{1860}}{(N_3+k/n)^3+1},\quad n=40000
    \end{aligned}
\]

<p>å®ƒéå¸¸æ¥è¿‘</p>
\[
    \begin{aligned}
        \int_{N_3}^{N_3+1}\frac{10^{1860}}{x^3+1}\mathrm{d}x &= 10^{1860}\cdot \left.\left(\frac{1}{\sqrt{3}}\mathrm{arctan}\frac{2x-1}{\sqrt{3}}-\frac{1}{6}\mathrm{log}(x^2-x+1)+\frac{1}{3}\mathrm{log}(x+1)\right)\right\vert_{N_3}^{N_3+1}\\
        &= F(N_3+1)-F(N_3)
    \end{aligned}
\]

<p>ä¹Ÿå³ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¦‚ä¸‹çš„æ–¹ç¨‹çš„æ ¹ï¼š</p>
\[
    F(x+1)-F(x)=Q_3
\]

<p>å½“\(x\)æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œ\(F(x+1)-F(x)\)å•è°ƒé€’å‡ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡äºŒåˆ†æ³•å¿«é€Ÿåœ°æ‰¾åˆ°ä¸Šè¿°æ–¹ç¨‹çš„æ ¹ã€‚</p>

<p>æ­¤å¤–ï¼Œæ³¨æ„åˆ°ä¸Šè¿°ä¸­çš„\(x\)éå¸¸å¤§ï¼Œæˆ‘ä»¬çš„å®šç§¯åˆ†å€¼éå¸¸æ¥è¿‘äºä¸€ä¸ªå®½ä¸º1çš„çŸ©å½¢çš„é¢ç§¯ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ±‚è§£æ–¹ç¨‹</p>
\[
    \frac{10^{1860}}{x^3+1}=Q_3
\]

<p>çš„æ ¹æ¥å¾—åˆ°\(N_3\)ã€‚</p>

<p>æ®æ­¤è§£å¯†ç¬¬ä¸‰ä¸ªRSAå¯†æ–‡å¾—åˆ°ï¼š</p>

<pre><code class="language-text">akaaba9ababa9bkka9kaaa9}</code></pre>
<br>

<p>Proof of Conceptï¼š</p>
<ul>
    <li><a underlined href="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/sol_cirno-no-perfect-sannsuu-kyoushitsu.sage">sol_cirno-no-perfect-sannsuu-kyoushitsu.sage</a></li>
</ul>
<br>

<p>FlagğŸš©ï¼š</p>
<pre><code class="language-text" style="color:red">Spirit{u_r_a_baka_1n_m4th_:p__--Cirno____baka9bakaaba9ababa9bkka9kaaa9}</code></pre>

<br><br>






<br><br><br>

<p>To Be Continued...</p>
<div class="center">
    <img src="/tales-of-the-martyrs/tales/oracle-of-namagiri/14/tbc.jpg" alt="To Be Continued..."></img>
</div>


</div>
<br><br><br><br><br><br>
<br><br><br><br><br><br><br><br><br><br><p style="color:gray">Tags: <span style="color:blue"><b>#CTF</b></span><span color="gray">, </span><span style="color:blue"><b>#SpiritCTF</b></span></p>
                    <p><div class="time"></div><span style="color:gray">Time: </span><b>2024-10-03 10:49</b></p><br><br><br><br><br><br>
	<script type="text/javascript" src="/essence-of-the-elders/spirit-of-mathematics/MathJax.js?config=TeX-AMS_HTML" async></script>
	<script type="text/x-mathjax-config;executed=true">
        window.MathJax.Hub.Config({
            showProcessingMessages: false,
            messageStyle: "none",
            jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [["$", "$"], ["\\(", "\\)"]],
                displayMath: [["$$", "$$"], ["\\[", "\\]"]],
                skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"]
            },
            "HTML-CSS": {
                availableFonts: ["STIX", "TeX"],
                showMathMenu: false
            },
			SVG: { linebreaks: {automatic: true } }
        });
        //window.MathJax.Hub.Queue(["Typeset", MathJax.Hub,document.getElementsByClassName("ck-content")]);
	</script>
	<script src="/essence-of-the-elders/spirit-of-codes/prism.js"></script>
</body>
</html>