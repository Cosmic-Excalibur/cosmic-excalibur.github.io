<div class="main">

!@#$%__LIMITED_EXPERTISE__%$#@!

<p>æœ¬æ–‡è®°å½•ä¸€ä¸ªç®€å•çš„å †åˆ©ç”¨é—®é¢˜ã€‚</p>
<p>é™„ä»¶ï¼š</p>
<ul>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagari/5/libc-2.23.so">ğŸ”—libc-2.23.so</a></li>
	<li><a href="/tales-of-the-martyrs/tales/oracle-of-namagari/5/timu">ğŸ”—timu</a></li>
</ul>

<br>

<ul class="section"><li>
Off by null
</li></ul>

<p>æœ¬é¢˜ä¸­é€šè¿‡é€‰é¡¹1åˆ›å»ºæ–°çš„ç¬”è®°ï¼Œé€šè¿‡é€‰é¡¹2åˆ é™¤ç¬”è®°ï¼Œé€‰é¡¹3æŸ¥çœ‹æ‰€æœ‰çš„ç¬”è®°ã€‚</p>

<p>ç„¶è€Œï¼Œåˆ›å»ºç¬”è®°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªnullå­—ç¬¦æº¢å‡ºè‡³ä¸‹ä¸€ä¸ªchunkä¸­ã€‚</p>

<p>æŸ¥çœ‹glibc 2.23æºç å¯çŸ¥ï¼Œä¸€ä¸ªè¢«åˆ†é…çš„chunkå…·æœ‰å¦‚ä¸‹ç»“æ„ï¼š<comment>ï¼ˆmalloc.cï¼Œ1111~1122ï¼Œ1142~1153ï¼‰</comment></p>
<br>

<pre><code class='language-c'>struct malloc_chunk {

  INTERNAL_SIZE_T      prev_size;  /* Size of previous chunk (if free).  */
  INTERNAL_SIZE_T      size;       /* Size in bytes, including overhead. */

  struct malloc_chunk* fd;         /* double links -- used only if free. */
  struct malloc_chunk* bk;

  /* Only used for large blocks: pointer to next larger size.  */
  struct malloc_chunk* fd_nextsize; /* double links -- used only if free. */
  struct malloc_chunk* bk_nextsize;
};</code></pre>
<br>

<pre><code class='language-text'>    chunk-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |             Size of previous chunk, if allocated            | |
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |             Size of chunk, in bytes                       |M|P|
      mem-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |             User data starts here...                          .
            .                                                               .
            .             (malloc_usable_size() bytes)                      .
            .                                                               |
nextchunk-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |             Size of chunk                                     |
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre>

<p></p>

<br>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å°†ä¸‹ä¸€ä¸ªchunkä¸­çš„prev_inuseä½è¦†ç›–ä¸º0ã€‚</p>

<ul class="section"><li>
The fastbin attack while freeing chunks
</li></ul>

<p>glibc 2.23ä¸­ï¼Œè¢«åˆ†é…çš„chunkåœ¨è¢«é‡Šæ”¾æ—¶è‹¥å¤§å°åœ¨<code>MINSIZE</code>è‡³<code>get_max_fast()</code>ä¹‹é—´ï¼Œé‚£ä¹ˆè¯¥chunkä¼šè¿›å…¥åºå·ä¸º<code>fastbin_index(size)</code>çš„fastbinä¸­ï¼Œæ­¤å¤–ï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶<code>TRIM_FASTBINS</code>è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¯¥chunkåœ¨ä¸‹ä¸€ä¸ªchunkæ˜¯top chunkæ—¶å°†ä¸ä¼šè¢«æ”¾åˆ°fastbinä¸­ã€‚<comment>ï¼ˆmalloc.cï¼Œ3886~3955ï¼‰</comment></p>
<tag id="tag1"><comment>(*)</comment></tag>

<p>ä¸Šè¿°ä¸­ç›¸å…³çš„æ•°å€¼é‡å®šä¹‰å¦‚ä¸‹ï¼ˆæœ‰åˆ æ”¹ï¼‰ï¼š<comment>ï¼ˆmalloc.cï¼‰</comment></p><br>

<pre><code class='language-c'>#define SIZE_SZ                (sizeof(size_t))
#define MALLOC_ALIGNMENT       (2 * SIZE_SZ)
#define MALLOC_ALIGN_MASK      (MALLOC_ALIGNMENT - 1)
#define DEFAULT_MXFAST         (64 * SIZE_SZ / 4)
#define get_max_fast() \
  ((DEFAULT_MXFAST + SIZE_SZ) & ~MALLOC_ALIGN_MASK)
#define fastbin_index(sz) \
  ((((unsigned int) (sz)) >> (SIZE_SZ == 8 ? 4 : 3)) - 2)
</code></pre>
<br>

<p><a href='#tag1'>Goto tag1</a></p>
<p><comment>Not finished yet.........</comment></p>


</div>
<br><br><br><br><br><br>